pico-8 cartridge // http://www.pico-8.com
version 41
__lua__
-- constants
x = 0  y = 64
dx = 0.5  dy = 0
jump_strength = 4.5
gravity_strength = 0.25
ceil_vel_bleed = 6 -- 1/x * dy

player_x_pos = 32

score = 0
max_score = 10
bugs = {}
blood = {}

accepting_input = true
scene = 'start'

--bug_chance = 75 -- 1/x chance per frame

sprite_size = 8 -- size in pixels

palt(14, true)
palt(0, false)

function jump()
	if accepting_input then
		dy += jump_strength
		accepting_input = false
	end
end

function get_inputs()
	if scene != 'start' then
		if (not btn(‚ùé)) and (not btn(üÖæÔ∏è)) then
			accepting_input = true
		end
	 if (btn(‚ùé)) then jump() end
	 if (btn(üÖæÔ∏è)) then new_bug() end
	else
		if (btn(‚ùé)) then scene = 'game' end
	end
end

function get_collisions()
	for i=1, count(bugs) do
		if (bugs[i][1] < player_x_pos+sprite_size and
		bugs[i][1]+8 > player_x_pos) then
			if (bugs[i][2] < y+sprite_size and
			bugs[i][2]+8 > y) then
				add(blood, bugs[i])
				del(bugs, bugs[i])
				sfx(0)
				score += 1
				break
			end 
		end
	end
end
		
function move_bugs()
	for i=1, count(bugs) do
		bugs[i][1] -= (dx*rnd(8))
		-- vertical movement
		magnitude = rnd(4)
		direction = rnd(2)*bugs[i][3] -- apparently i don't understand rnd()
		if direction > 1 then
			bugs[i][2] += magnitude
		else
			bugs[i][2] -= magnitude
		end
		
		-- keeping in frame
		if bugs[i][2] < 0 then
			bugs[i][2] = 0
		else if (bugs[i][2]+8 > 128) then
			bugs[i][2] = 120
		end
		end
		
		-- edge of frame
		if bugs[i][1] < -8 then
			score -= 1
			del(bugs, bugs[i])
			break
		end
		
	end
end

function new_bug()
	if accepting_input then
		-- {x pos, y pos, weight}
		add(bugs, {128, rnd(128)-20, rnd(2)})
		accepting_input = false
	end
end
  
function _update()
	if scene != 'start' then
		get_inputs()
		
		y -= dy
		
		-- keeping inside screen
		if y < 0 then
			y = 0
			dy = dy/ceil_vel_bleed
		else if y+sprite_size > 128 then
			y = 128 - sprite_size
			dy = -2
		end
		end
			
		-- gravitational acceleration
		dy -= gravity_strength
		if dy <= -10 then dy = -2 end
		
		-- background lateral movement
		x += dx
		if x >= 112 then x = 0 end
		-- with blood
		for i=1, count(blood) do
			blood[i][1] -= dx*8
			if blood[i][1] < -8 then
				-- to prevent memory leakage
				del(blood, blood[i])
				break
			end
		end
	
		-- handle_bugs
		get_collisions()
		move_bugs()
		-- generate new bug (unused)
		--[[
		if flr(rnd(bug_chance)) == 1 then
			new_bug()
		end]]
		
		-- game complete
		if score >= max_score then
			end_screen()
		end
	else
		get_inputs()
	end
end
 
function _draw()
	if scene != 'start' then
	 -- clear
	 cls(5)
	 
	 -- draw background
	 map(x, 0, 0, 0, 16, 16)
	 
	 -- draw player
	 if score < 5 then
	 	spr(1, player_x_pos, y)
	 else
	 	spr(14, player_x_pos, y)
	 end
	 
	 -- draw bugs
	 for i=1, count(bugs) do
	 	spr(2, bugs[i][1], bugs[i][2])
	 end
	 
	 -- draw blood
	 for i=1, count(blood) do
	 	spr(3, blood[i][1], blood[i][2])
	 end
	 
	 -- score
	 print('score: ', 4, 4, 6)
	 print(score..'/'..max_score, 34, 4, 8)
	
		print('time: '..flr(time()), 4, 12, 6)
	
		-- instructions
		print('x to jump, z to spawn bug', 4, 118, 6)
	else
		-- start screen
		cls(s)
		
		map(0, 24, 40, 16, 6, 3)
		
		--print('you are playing', 4, 4, 9)
		--print('flappy shrike', 69, 4, 8)
		
		print('press x to begin', 4, 84, 9)
		print('eaten bug is +1 pt\nescaped bug is -1 pt', 4, 102, 6)
		print('this is nonderivative', 4, 118, 6)
		--print('x to start', 4, 118, 6)
	end
end
-->8
function end_screen()
	cls()
	print('game over!',4, 4, 8)
	print('game finished in '..time()..' seconds', 4, 12, 8)
	stop()
end
-->8
shrike_facts = {
	
}
__gfx__
eeeeeeeee00000ee00800800e8eeeeeecccccccc33333333cccccccc3333333bcccccccccccc000ccc0000cccc0000cccccc88cccccccccce00000ee00000000
eeeeeeee004070eee011110eeee88e8ecccccccc33333333ccccccccb33333bbccc0000cccc07700c00aa00cc008800ccccc88cccccccccc004070ee00000000
eeeeeeee044070eee000000e8e888888cc0ccc0c33333333ccccccccbb333322c000770ccc00077000aaaa0000888800ccccc8cccc0ccc0c044070ee00000000
eeeeeeee0444000e00110100888888e8c000c00033333333cccccccc223b3323c0770770c00707700aaaaaa008888880ccccccccc000c8000444000e00000000
eeeeeeee04405550e011010ee88888880030003033333333cccccccc23bbb333c0770000c07777000aaaaaa008888880ccccc8cc003088300440558000000000
eeeeeeee0ff0555000110100e8888eee0333033333333333cccccccc33222333cc00770cc007000c00aaaa0008888800cccccccc0333883308f0888000000000
eeeeeeee00ff0000e001000eee88e8ee3333333333333333cccccccc33323333ccc0000ccc000cccc00aa00cc008880ccccccccc3333383800ff000000000000
eeeeeeeee00000ee0e0000e0ee8eeeee3333333333333333cccccccc33333333cccccccccccccccccc0000cccc0888ccccccc8cc33333383e00000ee00000000
88888880888000000008000088888000880008800088888088808880888880008888888088800880888888800000000000000000000000000000000000000000
88888880880000000008800088888800888088800888888008808800888888000888880088008880888888800000000000000000000000000000000000000000
88000880880000000088800088000880088888000880008008808800880008800088800088088800880000800099909009099900000000000000000000000000
88000080880000000080880088000880008880000888000008888800880008800088800088888000888800000009009009090000000000000000000000000000
88888000880000800880080088888800000880000088880008888800888888000088800088888000888800800009009999099900000000000000000000000000
88088000880008800888880088888000000880008000888008808800888880000088800088088800880008800009009009090000000000000000000000000000
88008000888888808888880088000000000880008880888008808800880088000888880088008880888888800009009009099900000000000000000000000000
88000000888888808800088088800000008888008888880088808880888088808888888088800880888888800000000000000000000000000000000000000000
__map__
0606060606060606060606060606060606060606060606060606060606060606060606060606060606080606060606060606060606060606060606060606060606060606060606060606060606060606060606060606060606060606060606060606060606060606060606060606060606060606060606060606060606060606
08060606060906080606060606060606060608060606060609060606060606060606060606080606060606060606060609060a06060606060606060606060606060608060606060606060606060606090606060606060606060608080606060a0606060608060606060606060606060806060606090608060606060606060606
080606060606060606060a060609060606080606080606060606060906060606060606060609060606060606060606060606060606060606060606060806060606060606060606080606060609060a0606060606060606060606060909060606060606060606060606060606060606080606060606060606060b060609060606
060606060606060606060606060606060606060606060606060606060606060606060606060606060606060606060606060606060606060606060806060606060606060606060606060606060606060606060606060606060606060606060606060606060606060606060606060606060606060606060606060c060606060606
040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040d040404040404
0505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050705050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505
0505050505050505050505050505050505050505050505050505050505050505070505050505050505050505050505050505050505050505050505050507050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505
0505050505050507050505050505070505050505050505050505050505050505050505050505050505070505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050507050505050505070505
0705050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050705050505050505050507050505050505050505050505050505050505050505050505070505050705050505050505050505050505050505
0505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050507050505050505050505050505050505050505050505050505
0505050507050505050505050505050505050505050505070505050505050505050707050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050507050505050505050505050505
0505050505050505050505050507050505050505050505050505050505050505050505050505050505050505050507050505050505050705050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050507050505
0505050505050507050505050505050505050505050505050505050505050505050505070705050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050707050505050505050505050505050505050505050505050505050505050505050507050505050505050505
0507050505050507070505050505050505050505050505070505050505050705050505050507050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505070505050705050507050505050507070505050505050505
0505050705050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050507050505050505050505050507050505050505050505050505050505050505050505050505050505050505050505070505050705050505050505050505050505
0505050505050507050505050505070505050505050505050505050505050505050505050505050505050505070505050505050505050505050507050505070505050505050505050505050505050505050505050505050505050505050507050505050507050505050505050505050505050505050507050505050505070505
0505050505050505050505050505050505050505050505050505050507050505050505050505050505050505050505050505050505050505050505050505050507050505050507070505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505
0505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505070505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505
0505050505050505050505050505050505050705050505050505050505050505050507050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505
0505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1011121313140000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00001b1c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
15161718191a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
000100002a15028150271502515023150201501e1501b150191501715015150111500e1500c15009150021501a000190001700015000140001200011000137000f0000e0000c0000a00009000070000600005000
